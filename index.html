<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FreelanceFlow AI</title>
  <script src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.24.6/babel.min.js"></script>
  <script src="https://unpkg.com/react-router-dom@6.26.1/dist/umd/react-router-dom.development.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { BrowserRouter, Route, Routes, Link, useNavigate } = ReactRouterDOM;

    // Firebase Configuration (Replace with your Firebase config)
    const firebaseConfig = {
      apiKey: "AIzaSyB91TDRW-yw-ZXJmK7M2itwIAIFNOGJTEs",
      authDomain: "freelancerdashboard-ca55a.firebaseapp.com",
      projectId: "freelancerdashboard-ca55a",
      storageBucket: "freelancerdashboard-ca55a.firebasestorage.app",
      messagingSenderId: "371513193298",
      appId: "1:371513193298:web:75745abaabee7c2d75008b",
      measurementId: "G-GKNZWEJJ8Q"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Mock AI pitch generator
    const generateAIPitch = (skills, gigDetails) => {
      return `Hi, I'm a skilled freelancer specializing in ${skills.join(", ")}. I'm excited to offer my services for your ${gigDetails.projectType} project with a budget of $${gigDetails.budget}. My expertise ensures high-quality delivery tailored to your needs. Let's collaborate to bring your vision to life!`;
    };

    // Main App Component with Routing
    function App() {
      const [user, setUser] = useState(null);
      const [isSignUp, setIsSignUp] = useState(true);

      return (
        <BrowserRouter>
          <div className="min-h-screen bg-gray-100">
            {user ? (
              <Routes>
                <Route path="/" element={<Dashboard user={user} setUser={setUser} />} />
                <Route path="/gigs" element={<GigMatches user={user} />} />
                <Route path="/messages" element={<Messages user={user} />} />
                <Route path="/payments" element={<Payments user={user} />} />
              </Routes>
            ) : (
              <AuthForm isSignUp={isSignUp} setIsSignUp={setIsSignUp} setUser={setUser} />
            )}
          </div>
        </BrowserRouter>
      );
    }

    // Authentication Form Component
    function AuthForm({ isSignUp, setIsSignUp, setUser }) {
      const [email, setEmail] = useState("");
      const [password, setPassword] = useState("");
      const [name, setName] = useState("");

      const handleSubmit = (e) => {
        e.preventDefault();
        setUser({ email, name: isSignUp ? name : email.split("@")[0], skills: [], gigs: [] });
      };

      return (
        <div className="max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md">
          <h2 className="text-2xl font-bold mb-4">{isSignUp ? "Sign Up" : "Sign In"}</h2>
          <form onSubmit={handleSubmit}>
            {isSignUp && (
              <div className="mb-4">
                <label className="block text-gray-700">Name</label>
                <input
                  type="text"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  className="w-full p-2 border rounded"
                  required
                />
              </div>
            )}
            <div className="mb-4">
              <label className="block text-gray-700">Email</label>
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="w-full p-2 border rounded"
                required
              />
            </div>
            <div className="mb-4">
              <label className="block text-gray-700">Password</label>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="w-full p-2 border rounded"
                required
              />
            </div>
            <button
              type="submit"
              className="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
            >
              {isSignUp ? "Sign Up" : "Sign In"}
            </button>
          </form>
          <p className="mt-4 text-center">
            {isSignUp ? "Already have an account?" : "Don't have an account?"}
            <button
              onClick={() => setIsSignUp(!isSignUp)}
              className="text-blue-500 ml-1 hover:underline"
            >
              {isSignUp ? "Sign In" : "Sign Up"}
            </button>
          </p>
        </div>
      );
    }

    // Dashboard Component (Updated with Firestore for Portfolio)
    function Dashboard({ user, setUser }) {
      const [skills, setSkills] = useState(user.skills);
      const [newSkill, setNewSkill] = useState("");
      const [gigDetails, setGigDetails] = useState({ projectType: "", budget: "" });
      const [pitch, setPitch] = useState("");
      const [gigs, setGigs] = useState(user.gigs);
      const [portfolio, setPortfolio] = useState([]);
      const [newPortfolioItem, setNewPortfolioItem] = useState({ title: "", description: "" });

      useEffect(() => {
        // Fetch portfolio items from Firestore
        db.collection("portfolios")
          .where("userEmail", "==", user.email)
          .get()
          .then((querySnapshot) => {
            const items = [];
            querySnapshot.forEach((doc) => {
              items.push({ id: doc.id, ...doc.data() });
            });
            setPortfolio(items);
          })
          .catch((error) => {
            console.error("Error fetching portfolio: ", error);
          });
      }, [user.email]);

      const addSkill = () => {
        if (newSkill && !skills.includes(newSkill)) {
          setSkills([...skills, newSkill]);
          setNewSkill("");
        }
      };

      const generatePitch = () => {
        if (skills.length && gigDetails.projectType && gigDetails.budget) {
          const newPitch = generateAIPitch(skills, gigDetails);
          setPitch(newPitch);
        } else {
          alert("Please add skills and complete gig details.");
        }
      };

      const approvePitch = () => {
        if (pitch) {
          setGigs([...gigs, { ...gigDetails, pitch }]);
          setGigDetails({ projectType: "", budget: "" });
          setPitch("");
        }
      };

      const addPortfolioItem = () => {
        if (newPortfolioItem.title && newPortfolioItem.description) {
          const portfolioItem = {
            userEmail: user.email,
            title: newPortfolioItem.title,
            description: newPortfolioItem.description,
            createdAt: new Date().toISOString()
          };
          db.collection("portfolios")
            .add(portfolioItem)
            .then((docRef) => {
              setPortfolio([...portfolio, { id: docRef.id, ...portfolioItem }]);
              setNewPortfolioItem({ title: "", description: "" });
            })
            .catch((error) => {
              console.error("Error adding portfolio item: ", error);
            });
        }
      };

      const logout = () => {
        setUser(null);
      };

      return (
        <div className="max-w-4xl mx-auto p-6">
          {/* Navigation Bar */}
          <nav className="bg-blue-500 p-4 mb-6 rounded-lg">
            <ul className="flex space-x-6 text-white">
              <li><Link to="/" className="hover:underline">Dashboard</Link></li>
              <li><Link to="/gigs" className="hover:underline">Gig Matches</Link></li>
              <li><Link to="/messages" className="hover:underline">Messages</Link></li>
              <li><Link to="/payments" className="hover:underline">Payments</Link></li>
              <li>
                <button
                  onClick={logout}
                  className="bg-red-500 px-4 py-2 rounded hover:bg-red-600"
                >
                  Logout
                </button>
              </li>
            </ul>
          </nav>

          <h1 className="text-3xl font-bold mb-6">Welcome to FreelanceFlow AI, {user.name}</h1>

          {/* Skills Section */}
          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 className="text-xl font-semibold mb-4">Your Skills</h2>
            <div className="flex mb-4">
              <input
                type="text"
                value={newSkill}
                onChange={(e) => setNewSkill(e.target.value)}
                placeholder="e.g., Web Development"
                className="flex-1 p-2 border rounded-l"
              />
              <button
                onClick={addSkill}
                className="bg-blue-500 text-white px-4 py-2 rounded-r hover:bg-blue-600"
              >
                Add
              </button>
            </div>
            <div className="flex flex-wrap gap-2">
              {skills.map((skill, index) => (
                <span
                  key={index}
                  className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full"
                >
                  {skill}
                </span>
              ))}
            </div>
          </div>

          {/* Gig Details Section */}
          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 className="text-xl font-semibold mb-4">Add Gig Details</h2>
            <div className="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label className="block text-gray-700">Project Type</label>
                <input
                  type="text"
                  value={gigDetails.projectType}
                  onChange={(e) =>
                    setGigDetails({ ...gigDetails, projectType: e.target.value })
                  }
                  placeholder="e.g., Website Design"
                  className="w-full p-2 border rounded"
                />
              </div>
              <div>
                <label className="block text-gray-700">Budget ($)</label>
                <input
                  type="number"
                  value={gigDetails.budget}
                  onChange={(e) =>
                    setGigDetails({ ...gigDetails, budget: e.target.value })
                  }
                  placeholder="e.g., 500"
                  className="w-full p-2 border rounded"
                />
              </div>
            </div>
            <button
              onClick={generatePitch}
              className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
            >
              Generate AI Pitch
            </button>
          </div>

          {/* Pitch Section */}
          {pitch && (
            <div className="bg-white p-6 rounded-lg shadow-md mb-6">
              <h2 className="text-xl font-semibold mb-4">Generated Pitch</h2>
              <p className="text-gray-700 mb-4">{pitch}</p>
              <button
                onClick={approvePitch}
                className="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600"
              >
                Approve & Save Pitch
              </button>
            </div>
          )}

          {/* Saved Gigs Section */}
          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 className="text-xl font-semibold mb-4">Your Gigs</h2>
            {gigs.length ? (
              gigs.map((gig, index) => (
                <div key={index} className="border-b py-4">
                  <p><strong>Project Type:</strong> {gig.projectType}</p>
                  <p><strong>Budget:</strong> ${gig.budget}</p>
                  <p><strong>Pitch:</strong> {gig.pitch}</p>
                </div>
              ))
            ) : (
              <p>No gigs saved yet.</p>
            )}
          </div>

          {/* Portfolio Section */}
          <div className="bg-white p-6 rounded-lg shadow-md">
            <h2 className="text-xl font-semibold mb-4">Your Portfolio</h2>
            <div className="mb-4">
              <label className="block text-gray-700">Project Title</label>
              <input
                type="text"
                value={newPortfolioItem.title}
                onChange={(e) =>
                  setNewPortfolioItem({ ...newPortfolioItem, title: e.target.value })
                }
                placeholder="e.g., E-commerce Website"
                className="w-full p-2 border rounded mb-2"
              />
              <label className="block text-gray-700">Description</label>
              <textarea
                value={newPortfolioItem.description}
                onChange={(e) =>
                  setNewPortfolioItem({ ...newPortfolioItem, description: e.target.value })
                }
                placeholder="e.g., Built a responsive e-commerce site with React and Firebase."
                className="w-full p-2 border rounded"
              />
              <button
                onClick={addPortfolioItem}
                className="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
              >
                Add to Portfolio
              </button>
            </div>
            {portfolio.length ? (
              portfolio.map((item, index) => (
                <div key={index} className="border-b py-4">
                  <p><strong>Title:</strong> {item.title}</p>
                  <p><strong>Description:</strong> {item.description}</p>
                </div>
              ))
            ) : (
              <p>No portfolio items yet.</p>
            )}
          </div>
        </div>
      );
    }

    // Gig Matches Component (Using Firestore)
    function GigMatches({ user }) {
      const [availableGigs, setAvailableGigs] = useState([]);

      useEffect(() => {
        db.collection("gigs").get().then((querySnapshot) => {
          const gigs = [];
          querySnapshot.forEach((doc) => {
            gigs.push({ id: doc.id, ...doc.data() });
          });
          const matchedGigs = gigs.filter(gig =>
            gig.skills.some(skill => user.skills.includes(skill))
          );
          setAvailableGigs(matchedGigs);
        }).catch((error) => {
          console.error("Error fetching gigs: ", error);
        });
      }, [user.skills]);

      return (
        <div className="max-w-4xl mx-auto p-6">
          <nav className="bg-blue-500 p-4 mb-6 rounded-lg">
            <ul className="flex space-x-6 text-white">
              <li><Link to="/" className="hover:underline">Dashboard</Link></li>
              <li><Link to="/gigs" className="hover:underline">Gig Matches</Link></li>
              <li><Link to="/messages" className="hover:underline">Messages</Link></li>
              <li><Link to="/payments" className="hover:underline">Payments</Link></li>
            </ul>
          </nav>
          <h1 className="text-3xl font-bold mb-6">Gig Matches</h1>
          <div className="bg-white p-6 rounded-lg shadow-md">
            {availableGigs.length ? (
              availableGigs.map((gig) => (
                <div key={gig.id} className="border-b py-4">
                  <p><strong>Title:</strong> {gig.title}</p>
                  <p><strong>Budget:</strong> ${gig.budget}</p>
                  <p><strong>Required Skills:</strong> {gig.skills.join(", ")}</p>
                  <button className="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Apply
                  </button>
                </div>
              ))
            ) : (
              <p>No matching gigs found. Add more skills to improve your matches!</p>
            )}
          </div>
        </div>
      );
    }

    // Messages Component (Using Firestore)
    function Messages({ user }) {
      const [messages, setMessages] = useState([]);
      const [newMessage, setNewMessage] = useState("");

      useEffect(() => {
        db.collection("messages")
          .where("to", "==", user.email)
          .get()
          .then((querySnapshot) => {
            const fetchedMessages = [];
            querySnapshot.forEach((doc) => {
              fetchedMessages.push({ id: doc.id, ...doc.data() });
            });
            setMessages(fetchedMessages);
          })
          .catch((error) => {
            console.error("Error fetching messages: ", error);
          });
      }, [user.email]);

      const sendMessage = () => {
        if (newMessage) {
          const message = {
            from: user.email,
            to: "Client A", // Mock recipient (in a real app, this would be dynamic)
            text: newMessage,
            timestamp: new Date().toISOString()
          };
          db.collection("messages")
            .add(message)
            .then((docRef) => {
              setMessages([...messages, { id: docRef.id, ...message }]);
              setNewMessage("");
            })
            .catch((error) => {
              console.error("Error sending message: ", error);
            });
        }
      };

      return (
        <div className="max-w-4xl mx-auto p-6">
          <nav className="bg-blue-500 p-4 mb-6 rounded-lg">
            <ul className="flex space-x-6 text-white">
              <li><Link to="/" className="hover:underline">Dashboard</Link></li>
              <li><Link to="/gigs" className="hover:underline">Gig Matches</Link></li>
              <li><Link to="/messages" className="hover:underline">Messages</Link></li>
              <li><Link to="/payments" className="hover:underline">Payments</Link></li>
            </ul>
          </nav>
          <h1 className="text-3xl font-bold mb-6">Messages</h1>
          <div className="bg-white p-6 rounded-lg shadow-md">
            <div className="mb-4">
              <textarea
                value={newMessage}
                onChange={(e) => setNewMessage(e.target.value)}
                placeholder="Type a message..."
                className="w-full p-2 border rounded"
              />
              <button
                onClick={sendMessage}
                className="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
              >
                Send
              </button>
            </div>
            {messages.length ? (
              messages.map((msg) => (
                <div key={msg.id} className="border-b py-4">
                  <p><strong>From:</strong> {msg.from}</p>
                  <p><strong>Message:</strong> {msg.text}</p>
                  <p><strong>Time:</strong> {msg.timestamp}</p>
                </div>
              ))
            ) : (
              <p>No messages yet.</p>
            )}
          </div>
        </div>
      );
    }

    // Payments Component (Still Mock, Not Using Firestore Yet)
    function Payments({ user }) {
      const [transactions, setTransactions] = useState([
        { id: 1, gig: "Website Design", amount: 1000, status: "Completed", date: "2025-04-28" },
        { id: 2, gig: "Logo Design", amount: 300, status: "Pending", date: "2025-04-29" }
      ]);

      return (
        <div className="max-w-4xl mx-auto p-6">
          <nav className="bg-blue-500 p-4 mb-6 rounded-lg">
            <ul className="flex space-x-6 text-white">
              <li><Link to="/" className="hover:underline">Dashboard</Link></li>
              <li><Link to="/gigs" className="hover:underline">Gig Matches</Link></li>
              <li><Link to="/messages" className="hover:underline">Messages</Link></li>
              <li><Link to="/payments" className="hover:underline">Payments</Link></li>
            </ul>
          </nav>
          <h1 className="text-3xl font-bold mb-6">Payments</h1>
          <div className="bg-white p-6 rounded-lg shadow-md">
            {transactions.length ? (
              transactions.map((tx) => (
                <div key={tx.id} className="border-b py-4">
                  <p><strong>Gig:</strong> {tx.gig}</p>
                  <p><strong>Amount:</strong> ${tx.amount}</p>
                  <p><strong>Status:</strong> {tx.status}</p>
                  <p><strong>Date:</strong> {tx.date}</p>
                </div>
              ))
            ) : (
              <p>No transactions yet.</p>
            )}
          </div>
        </div>
      );
    }

    // Render the app
    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
